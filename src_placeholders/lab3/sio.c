/****************************************************************************

    sio.c - ���������� ������� ����������������� ������
            ��� �������� ������ SDK-1.1

    (C) sio.c, ������ �.�.  2007 �.

��� ��������� ���������; �� ������ �������� �������������� �� �/���
�������������� �� � ������������ � ������������� ������������
��������� GNU, �������������� ������ ���������� ��; ���� ������ 2,
���� (�� ������ ������) ����� ����� ������� ������.

��� ��������� ���������������� � �������, ��� ��� ����� ��������,
�� ��� �����-���� ��������; ���� ��� ��������������� ��������
������������ �������� ��� ����������� ��� ���������� ����.  ���
��������� ��������� �������� �������� ������������� ������������
�������� GNU.

�� ������ ���� �������� ����� ������������� ������������ ��������
GNU ������ � ���� ����������; ���� ���, �������� �� ������: Free
Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
02111-1307 USA

----------------------------------------------------------------------------
������, �����-���������, ������� �������������� ������� ���������
e-mail: kluchev@d1.ifmo.ru

****************************************************************************/
#include "aduc812.h"


/**----------------------------------------------------------------------------
                        init_sio()
-------------------------------------------------------------------------------
�������������� ���������������� ����� �� �������� ��������. ���������� ������ 1

����:       char speed - ��������. �������� �����������, ���������� �
                ������������ ����� sio.h
            bit sdouble - ������������ ��������: 0 - �� ����������� ��������,
                �������� ���������� speed; 1 - �����������.
�����:      ���
���������:  ���
----------------------------------------------------------------------------- */
void init_sio( unsigned char speed )
{
    TH1       =  speed;
    TMOD     |=  0x20; //������ 1 ����� �������� � ������ autoreload
    TCON     |=  0x40; //������ ������� 1
    SCON      =  0x50; //��������� ����������������� ������
    ES        =  0;    //���������� ���������� �� �����������������
}

/**----------------------------------------------------------------------------
                        RSioStat()
-------------------------------------------------------------------------------
���������� ��������� ��������, ���� ����� ������ �� ����

����:       ���
�����:      ���
���������:  0 - ����� ������ ����;
            1 - ��� ������ ������
----------------------------------------------------------------------------- */
unsigned char rsiostat(void)
{
    return RI;
}


/**----------------------------------------------------------------------------
                        wsio
-------------------------------------------------------------------------------
���������� ������ �� ����������������� ������

����:       unsigned char c - ������, ������� ����� ���������
�����:      ���
���������:  ���
----------------------------------------------------------------------------- */
void wsio( unsigned char c )
{
    SBUF = c;
    TI   = 0;
    while( !TI );
}

/**----------------------------------------------------------------------------
                        rsio()
-------------------------------------------------------------------------------
���������� ������ ������� �� ����������������� ������ � ���������� ���.

����:       ���
�����:      ���
���������:  �������� ������
----------------------------------------------------------------------------- */
unsigned char rsio(void)
{
    while( !RI );
    RI = 0;
    return SBUF;
}


/**----------------------------------------------------------------------------
                        type()
-------------------------------------------------------------------------------
������� ASCIIZ-������ � ���������������� �����

����:       char *str - ��������� �� ������
�����:      ���
���������:  ���
----------------------------------------------------------------------------- */
void type(char * str)
{
    while( *str ) wsio( *str++ );
}